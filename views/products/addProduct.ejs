<%- include('../partials/header') %>

<main class="bg-light min-vh-100 py-5">
  <div class="container" style="max-width: 800px; margin-left: 350px;">
    <div class="card shadow border-0 rounded-4">
      
      <!-- HEADER -->
      <div class="card-header text-white py-3 rounded-top-4" 
           style="background: linear-gradient(135deg, #0062ff, #4a90e2);">
        <h4 class="mb-0 d-flex align-items-center justify-content-center gap-2">
          <i class="bi bi-box-seam fs-4"></i>
          <%= product ? "Edit Product" : "Add New Product" %>
        </h4>
      </div>

      <div class="card-body p-4">
        
        <!-- ALERTS -->
        <% if (typeof success !== 'undefined') { %>
          <div class="alert alert-success d-flex align-items-center">
            <i class="bi bi-check-circle-fill me-2"></i> <%= success %>
          </div>
        <% } %>
        <% if (typeof error !== 'undefined') { %>
          <div class="alert alert-danger d-flex align-items-center">
            <i class="bi bi-exclamation-triangle-fill me-2"></i> <%= error %>
          </div>
        <% } %>

        <!-- FORM -->
        <form action="<%= product ? '/dashboard/product/edit/' + product._id : '/product/create' %>" 
              method="POST" enctype="multipart/form-data" class="row g-3">

          <!-- Basic Info -->
          <div class="col-md-6">
            <label class="form-label fw-semibold">Name</label>
            <input name="name" type="text" class="form-control shadow-sm" 
                   value="<%= product ? product.name : '' %>" required>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">SKU</label>
            <input name="sku" type="text" class="form-control shadow-sm" 
                   value="<%= product ? product.sku : '' %>">
          </div>

          <div class="col-12">
            <label class="form-label fw-semibold">Description</label>
            <textarea name="description" class="form-control shadow-sm" rows="3"><%= product ? product.description : '' %></textarea>
          </div>

          <!-- Pricing -->
          <div class="col-md-3">
            <label class="form-label fw-semibold">Price</label>
            <input name="price" type="number" step="0.01" class="form-control shadow-sm" 
                   value="<%= product ? product.price : '' %>">
          </div>

          <div class="col-md-3">
            <label class="form-label fw-semibold">Discount (%)</label>
            <input name="discount" type="number" step="0.01" class="form-control shadow-sm" 
                   value="<%= product ? product.discount : '' %>">
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Brand</label>
            <input name="brand" type="text" class="form-control shadow-sm" 
                   value="<%= product ? product.brand : '' %>">
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Model Number</label>
            <input name="modelNumber" type="text" class="form-control shadow-sm" 
                   value="<%= product ? product.modelNumber : '' %>">
          </div>

          <!-- Category -->
          <div class="col-md-6">
            <label class="form-label fw-semibold">Category</label>
            <select name="category" class="form-select shadow-sm">
              <option value="">-- Select category --</option>
              <% categories?.forEach(c => { %>
                <option value="<%= c._id %>" <%= product && product.category == c._id ? 'selected' : '' %>>
                  <%= c.name %>
                </option>
              <% }) %>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Sub Category</label>
            <select name="subCategory" class="form-select shadow-sm">
              <option value="">-- Select sub category --</option>
              <% subCategories?.forEach(s => { %>
                <option value="<%= s._id %>" <%= product && product.subCategory == s._id ? 'selected' : '' %>>
                  <%= s.name %>
                </option>
              <% }) %>
            </select>
          </div>

          <!-- Inventory -->
          <div class="col-md-3">
            <label class="form-label fw-semibold">Stock</label>
            <input name="stock" type="number" class="form-control shadow-sm" 
                   value="<%= product ? product.stock : '' %>">
          </div>

          <div class="col-md-3">
            <label class="form-label fw-semibold">Batch Number</label>
            <input name="batchNumber" type="text" class="form-control shadow-sm" 
                   value="<%= product ? product.batchNumber : '' %>">
          </div>

          <div class="col-md-3">
            <label class="form-label fw-semibold">Expiry Date</label>
            <input name="expiryDate" type="date" class="form-control shadow-sm" 
                   value="<%= product ? product.expiryDate?.toISOString().split('T')[0] : '' %>">
          </div>

          <!-- Images -->
          <div class="col-12">
            <label class="form-label fw-semibold">Images</label>
            <div class="d-flex gap-2 flex-wrap mb-2">
              <% if(product && product.images && product.images.length > 0){ %>
                <% product.images.forEach(img => { %>
                  <div class="border rounded-3 overflow-hidden">
                    <img src="<%= img %>" 
                         style="width:100px; height:80px; object-fit:cover;">
                  </div>
                <% }) %>
              <% } else { %>
                <span class="text-muted">No images uploaded</span>
              <% } %>
            </div>
            <input name="images" type="file" accept="image/*" class="form-control shadow-sm" multiple>
            <small class="text-muted">Upload up to 6 images</small>
          </div>

          <!-- Extra Info -->
          <div class="col-md-6">
            <label class="form-label fw-semibold">Manufacturer</label>
            <input name="manufacturer" type="text" class="form-control shadow-sm" 
                   value="<%= product ? product.manufacturer : '' %>">
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Dimensions</label>
            <input name="dimensions" type="text" class="form-control shadow-sm" 
                   value="<%= product ? product.dimensions : '' %>">
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Warranty</label>
            <input name="warranty" type="text" class="form-control shadow-sm" 
                   value="<%= product ? product.warranty : '' %>">
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Shipping Info</label>
            <input name="shippingInfo" type="text" class="form-control shadow-sm" 
                   value="<%= product ? product.shippingInfo : '' %>">
          </div>

          <div class="col-12">
            <label class="form-label fw-semibold">Technical Details (JSON/Text)</label>
            <textarea name="technicalDetails" class="form-control shadow-sm" rows="3"><%= product ? product.technicalDetails : '' %></textarea>
          </div>

          <!-- Checkbox -->
          <div class="col-12 form-check mt-2">
            <input name="isAvailable" class="form-check-input" type="checkbox" value="true" id="isAvailable"
                   <%= product && product.isAvailable ? 'checked' : '' %>>
            <label class="form-check-label fw-semibold" for="isAvailable">
              <i class="bi bi-check2-circle me-1"></i> Available
            </label>
          </div>

          <!-- Submit -->
          <div class="col-12 mt-4 text-center">
            <button type="submit" class="btn btn-primary px-5 py-2 shadow-sm">
              <i class="bi bi-save2 me-2"></i>
              <%= product ? 'Update Product' : 'Save Product' %>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>

<%- include('../partials/footer') %>
