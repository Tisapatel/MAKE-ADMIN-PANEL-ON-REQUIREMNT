<!doctype html>
<html lang="en">

<head>
    <title>Edit Product</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light">
    <header>
        <%- include('../partials/header') %>
    </header>

    <main class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-lg border-0 rounded-4">
                    <div class="card-header bg-warning text-white text-center rounded-top-4 py-3">
                        <h4 class="mb-0">✏️ Edit Product</h4>
                    </div>
                    <% if (typeof success !== 'undefined') { %>
                        <div class="alert alert-success"><%= success %></div>
                    <% } %>
                    <% if (typeof error !== 'undefined') { %>
                        <div class="alert alert-danger"><%= error %></div>
                    <% } %>
                    <div class="card-body p-4">
                        <form action="/product/edit/<%= product._id %>" method="POST" enctype="multipart/form-data"
                            class="row g-3">

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Name</label>
                                <input name="name" type="text" class="form-control" value="<%= product.name %>"
                                    required>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">SKU</label>
                                <input name="sku" type="text" class="form-control" value="<%= product.sku %>">
                            </div>

                            <div class="col-12">
                                <label class="form-label fw-semibold">Description</label>
                                <textarea name="description" class="form-control"
                                    rows="3"><%= product.description %></textarea>
                            </div>

                            <div class="col-md-3">
                                <label class="form-label fw-semibold">Price</label>
                                <input name="price" type="number" step="0.01" class="form-control"
                                    value="<%= product.price %>">
                            </div>

                            <div class="col-md-3">
                                <label class="form-label fw-semibold">Discount (%)</label>
                                <input name="discount" type="number" step="0.01" class="form-control"
                                    value="<%= product.discount %>">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Brand</label>
                                <input name="brand" type="text" class="form-control" value="<%= product.brand %>">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Model Number</label>
                                <input name="modelNumber" type="text" class="form-control"
                                    value="<%= product.modelNumber %>">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Category</label>
                                <select name="category" class="form-select">
                                    <option value="">-- Select category --</option>
                                    <% categories?.forEach(c=> { %>
                                        <option value="<%= c._id %>" <%=product.category &&
                                            c._id.toString()===product.category._id.toString() ? 'selected' : '' %>><%=
                                                c.name %>
                                        </option>
                                        <% }) %>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Sub Category</label>
                                <select name="subCategory" class="form-select">
                                    <option value="">-- Select sub category --</option>
                                    <% subCategories?.forEach(s=> { %>
                                        <option value="<%= s._id %>" <%=product.subCategory &&
                                            s._id.toString()===product.subCategory._id.toString() ? 'selected' : '' %>>
                                            <%= s.name %>
                                        </option>
                                        <% }) %>
                                </select>
                            </div>

                            <div class="col-md-3">
                                <label class="form-label fw-semibold">Stock</label>
                                <input name="stock" type="number" class="form-control" value="<%= product.stock %>">
                            </div>

                            <div class="col-md-3">
                                <label class="form-label fw-semibold">Batch Number</label>
                                <input name="batchNumber" type="text" class="form-control"
                                    value="<%= product.batchNumber %>">
                            </div>

                            <div class="col-md-3">
                                <label class="form-label fw-semibold">Expiry Date</label>
                                <input name="expiryDate" type="date" class="form-control"
                                    value="<%= product.expiryDate ? product.expiryDate.toISOString().split('T')[0] : '' %>">
                            </div>

                            <div class="col-12">
                                <label class="form-label fw-semibold">Images</label>
                                <div class="d-flex gap-2 flex-wrap">
                                    <% if(product.images && product.images.length> 0){ %>
                                        <% product.images.forEach(img=> { %>
                                            <img src="<%= img %>" style="width:100px; height:80px; object-fit:cover;"
                                                class="border rounded">
                                            <% }) %>
                                                <% } else { %>
                                                    <span class="text-muted">No images available</span>
                                                    <% } %>
                                </div>
                            </div>


                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Manufacturer</label>
                                <input name="manufacturer" type="text" class="form-control"
                                    value="<%= product.manufacturer %>">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Dimensions</label>
                                <input name="dimensions" type="text" class="form-control"
                                    value="<%= product.dimensions %>">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Warranty</label>
                                <input name="warranty" type="text" class="form-control" value="<%= product.warranty %>">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Shipping Info</label>
                                <input name="shippingInfo" type="text" class="form-control"
                                    value="<%= product.shippingInfo %>">
                            </div>

                            <div class="col-12">
                                <label class="form-label fw-semibold">Technical Details (JSON or text)</label>
                                <textarea name="technicalDetails" class="form-control"
                                    rows="3"><%= product.technicalDetails %></textarea>
                            </div>

                            <div class="col-12 form-check mt-2">
                                <input name="isAvailable" class="form-check-input" type="checkbox" value="true"
                                    id="isAvailable" <%=product.isAvailable ? 'checked' : '' %>>
                                <label class="form-check-label fw-semibold" for="isAvailable">Available</label>
                            </div>

                            <div class="col-12 mt-4 text-center">
                                <button type="submit" class="btn btn-success px-5 py-2">Update Product</button>
                                <a href="/product/view" class="btn btn-secondary">Cancel</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <%- include('../partials/footer') %>

</body>

</html>