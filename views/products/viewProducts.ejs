<%- include('../partials/header') %>

<main class="content-wrapper bg-light py-5">
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="fw-bold mb-0 text-primary d-flex align-items-center gap-2">
        <i class="bi bi-box-seam"></i> Products List
      </h3>
    </div>

    <% if(products.length === 0){ %>
      <div class="alert alert-info text-center py-3 rounded-3 shadow-sm">
        <i class="bi bi-info-circle me-2"></i> No products found.
      </div>
    <% } else { %>

      <div class="table-responsive shadow-sm rounded-4 border bg-white">
        <table class="table align-middle table-hover mb-0">
          <thead class="table-light">
            <tr class="text-nowrap">
              <th>#</th>
              <th>Image</th>
              <th>Name</th>
              <th>SKU</th>
              <th>Brand</th>
              <th>Price</th>
              <th>Discount</th>
              <th>Stock</th>
              <th>Category</th>
              <th>Sub Category</th>
              <th>Available</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% products.forEach((product, index) => { %>
              <tr>
                <td class="fw-semibold"><%= index + 1 %></td>

                <!-- Product Images -->
                <td>
                  <% if(product.images?.length > 0){ %>
                    <img src="<%= product.images[0] %>" class="img-thumbnail border-0 shadow-sm" 
                         style="width:60px; height:50px; object-fit:cover;">
                  <% } else { %>
                    <div class="text-muted small">No Image</div>
                  <% } %>
                </td>

                <td class="fw-semibold"><%= product.name || '-' %></td>
                <td><%= product.sku || '-' %></td>
                <td><%= product.brand || '-' %></td>
                <td>â‚¹<%= product.price?.toFixed(2) || '0.00' %></td>
                <td><%= product.discount || 0 %>%</td>
                <td><%= product.stock || 0 %></td>

                <!-- Category -->
                <td>
                  <% if(product.category){ %>
                    <div class="d-flex align-items-center justify-content-center gap-1">
                      <% if(product.category.image){ %>
                        <img src="<%= product.category.image %>" 
                             style="width:35px;height:30px;object-fit:cover;border-radius:4px;">
                      <% } %>
                      <span class="small text-dark"><%= product.category.name %></span>
                    </div>
                  <% } else { %>-<% } %>
                </td>

                <!-- SubCategory -->
                <td>
                  <% if(product.subCategory){ %>
                    <div class="d-flex align-items-center justify-content-center gap-1">
                      <% if(product.subCategory.image){ %>
                        <img src="<%= product.subCategory.image %>" 
                             style="width:35px;height:30px;object-fit:cover;border-radius:4px;">
                      <% } %>
                      <span class="small text-dark"><%= product.subCategory.name %></span>
                    </div>
                  <% } else { %>-<% } %>
                </td>

                <td>
                  <% if(product.isAvailable){ %>
                    <span class="badge bg-success-subtle text-success border border-success-subtle px-3 py-1 rounded-pill">
                      <i class="bi bi-check2-circle me-1"></i> Yes
                    </span>
                  <% } else { %>
                    <span class="badge bg-danger-subtle text-danger border border-danger-subtle px-3 py-1 rounded-pill">
                      <i class="bi bi-x-circle me-1"></i> No
                    </span>
                  <% } %>
                </td>

                <!-- Actions -->
                <td class="text-nowrap">
                  <a href="/product/edit/<%= product._id %>" 
                     class="btn btn-sm btn-outline-primary me-1 shadow-sm">
                    <i class="bi bi-pencil-square"></i>
                  </a>
                  <a href="/product/delete/<%= product._id %>" 
                     class="btn btn-sm btn-outline-danger shadow-sm"
                     onclick="return confirm('Are you sure you want to delete this product?')">
                    <i class="bi bi-trash3"></i>
                  </a>
                </td>
              </tr>

              <!-- Collapsible details -->
              <tr class="table-light collapse-row">
                <td colspan="12" class="p-0">
                  <div class="collapse" id="details-<%= index %>">
                    <div class="p-3 bg-body-tertiary small text-start">
                      <p><strong>Description:</strong> <%= product.description || '-' %></p>
                      <p><strong>Batch:</strong> <%= product.batchNumber || '-' %></p>
                      <p><strong>Expiry:</strong> <%= product.expiryDate ? product.expiryDate.toISOString().split('T')[0] : '-' %></p>
                      <p><strong>Manufacturer:</strong> <%= product.manufacturer || '-' %></p>
                      <p><strong>Dimensions:</strong> <%= product.dimensions || '-' %></p>
                      <p><strong>Warranty:</strong> <%= product.warranty || '-' %></p>
                      <p><strong>Shipping Info:</strong> <%= product.shippingInfo || '-' %></p>
                      <p><strong>Technical Details:</strong> <%= product.technicalDetails || '-' %></p>
                    </div>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>
</main>

<%- include('../partials/footer') %>

<style>
.content-wrapper {
  margin-left: 250px;
  padding: 20px;
}

@media (max-width: 992px) {
  .content-wrapper { margin-left: 0; padding: 15px; }
}

.table thead th {
  background-color: #f8f9fa;
  font-weight: 600;
  color: #212529;
}

.table-hover tbody tr:hover {
  background-color: #f1f5ff !important;
  transition: background-color 0.2s ease;
}

.badge {
  font-size: 0.8rem;
}

.btn-outline-primary:hover,
.btn-outline-danger:hover {
  color: #fff !important;
}

.btn-outline-primary:hover {
  background-color: #0d6efd;
  border-color: #0d6efd;
}

.btn-outline-danger:hover {
  background-color: #dc3545;
  border-color: #dc3545;
}
</style>
